graph TD
    %% ====================================================================
    %% CLIENT LAYER
    %% ====================================================================
    subgraph Clients["üåê CLIENT LAYER"]
        CitizenWeb["üë§ Citizen Web Client<br/>(Dashboard, Alerts)"]
        Researcher["üî¨ Researcher Client<br/>(Data Export, Analytics)"]
        Admin["‚öôÔ∏è Admin Client<br/>(System Management)"]
    end

    %% ====================================================================
    %% PRESENTATION LAYER
    %% ====================================================================
    subgraph Presentation["üé® PRESENTATION LAYER"]
        WebFrontend["Web Frontend<br/>(React/Vue + TypeScript)<br/>Responsive Design"]
    end

    %% ====================================================================
    %% API LAYER
    %% ====================================================================
    subgraph APILayer["üîå API LAYER (REST/JSON)"]
        ApiPublic["üì§ Public REST API<br/>(Citizen & Researcher)<br/>Read: AQI, History, Alerts"]
        ApiAdmin["üîê Admin REST API<br/>(Administration)<br/>User Mgmt, Config, Logs"]
    end

    %% ====================================================================
    %% DATA PERSISTENCE LAYER
    %% ====================================================================
    subgraph DataLayer["üíæ DATA PERSISTENCE LAYER"]
        PG["üêò PostgreSQL + TimescaleDB<br/>- Operational Data<br/>- Raw Readings (Hypertable)<br/>- Users, Alerts, Recommendations<br/>- Daily Aggregates (Analytical)"]
        NoSQL["üìã NoSQL Document Store<br/>(MongoDB/Cosmos DB)<br/>- User Preferences<br/>- Dashboard Configs"]
    end

    %% ====================================================================
    %% BATCH PROCESSING LAYER
    %% ====================================================================
    subgraph BatchJobs["‚ö° BATCH PROCESSING LAYER (Scheduled Jobs)"]
        ExternalAPI["üåç External Air Quality APIs<br/>(AQICN, Google, IQAir)"]
        IngestionJob["üì• Ingestion Job<br/>(10-60 min interval)<br/>Fetch raw JSON payloads"]
        Normalizer["üîß Normalizer & Validator<br/>- Schema validation<br/>- Unit harmonization<br/>- Deduplication<br/>- Timestamp normalization"]
        DailyAgg["üìä Daily Aggregation Job<br/>(Off-peak, 1x/day)<br/>Compute AQI stats"]
    end

    %% ====================================================================
    %% OBSERVABILITY LAYER
    %% ====================================================================
    subgraph Observability["üìà OBSERVABILITY"]
        AppLogs["üìù Application Logs<br/>(Structured Logging)<br/>- API requests/responses<br/>- Ingestion metrics<br/>- Errors & alerts"]
    end

    %% ====================================================================
    %% CONNECTIONS: CLIENT -> PRESENTATION
    %% ====================================================================
    CitizenWeb -->|Web Browser HTTPS| WebFrontend
    Researcher -->|Web Browser HTTPS| WebFrontend
    Admin -->|Web Browser HTTPS| WebFrontend

    %% ====================================================================
    %% CONNECTIONS: PRESENTATION -> API
    %% ====================================================================
    WebFrontend -->|REST JSON| ApiPublic
    WebFrontend -->|REST JSON Admin| ApiAdmin

    %% ====================================================================
    %% CONNECTIONS: API -> DATA
    %% ====================================================================
    ApiPublic -->|Read/Write| PG
    ApiPublic -->|Read/Write| NoSQL
    ApiAdmin -->|Read/Write| PG
    ApiAdmin -->|Read/Write| NoSQL

    %% ====================================================================
    %% CONNECTIONS: BATCH JOBS -> DATA
    %% ====================================================================
    ExternalAPI -->|API Calls| IngestionJob
    IngestionJob -->|Raw Payloads| Normalizer
    Normalizer -->|Insert/Upsert| PG
    DailyAgg -->|Query & Aggregate| PG
    DailyAgg -->|Insert Stats| PG

    %% ====================================================================
    %% CONNECTIONS: ALL -> OBSERVABILITY
    %% ====================================================================
    ApiPublic -->|Log Events| AppLogs
    ApiAdmin -->|Log Events| AppLogs
    IngestionJob -->|Log Events| AppLogs
    Normalizer -->|Log Events| AppLogs
    DailyAgg -->|Log Events| AppLogs

    %% ====================================================================
    %% STYLING
    %% ====================================================================
    classDef clientStyle fill:#e1f5fe,stroke:#01579b,stroke-width:2px,color:#000
    classDef apiStyle fill:#f3e5f5,stroke:#4a148c,stroke-width:2px,color:#000
    classDef dataStyle fill:#e8f5e9,stroke:#1b5e20,stroke-width:2px,color:#000
    classDef batchStyle fill:#fff3e0,stroke:#e65100,stroke-width:2px,color:#000
    classDef obsStyle fill:#fce4ec,stroke:#880e4f,stroke-width:2px,color:#000

    class Clients clientStyle
    class Presentation clientStyle
    class APILayer apiStyle
    class DataLayer dataStyle
    class BatchJobs batchStyle
    class Observability obsStyle